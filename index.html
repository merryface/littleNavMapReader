<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./style.css">
  <link rel="icon" type="image/x-icon" href="./favicon.ico">
  <title>LitteNavMap Translator</title>
</head>
<body>
  <div class="container">
    <header class="header">
      <h1 class="title">Little NavMap to Airport List Converter</h1>
      <p class="subtitle">Upload a littleNavMap file and get a list of all the airports in the route</p>
    </header>

    <div class="inputData">
      <div class="button-wrap">
        <label for="inputfile" class="button">Upload .lnmpln file</label>
        <input type="file" name="inputfile" id="inputfile" class="hidden">
      </div>

    </div>

    <div class="outputData">
      <div class="topLine">
        <div class="departure hub">
          <p class="label">Departure:</p>
          <p id="departureAirport"></p>
        </div>

        <div class="destination hub">
          <p class="label">Destination:</p>
          <p id="destinationAirport"></p>
        </div>
      </div>

      <div class="dataLine">
        <p class="label">Route Summary:</p>
        <p id="routeSummary"></p>
      </div>

      <div class="dataLine">
        <p class="label">Routing Data:</p>
        <p id="routeData"></p>
      </div>


    </div>

  </div>

      
    <script type="text/javascript">
        document.getElementById('inputfile')
            .addEventListener('change', function() {
            let fr=new FileReader();
            fr.onload=function(){
              text = fr.result;
              planData = fr.result.split(`\n`);
              let airports = [];
              let routeInfo = [];

              planData.forEach(line => {
                if (line.substr(9)[0] == "I") {
                  airports.push(line.substr(7).slice(8,-9))
                }

                if (line.substr(9)[0] == "P") {
                  routeInfo.push(line.substr(5).slice(8,-16))
                }
              })
              let summary = airports.join(" ");
              let info = routeInfo.join(" \n ");


              //Departure
              document.getElementById('departureAirport').textContent=airports[0];

              //Destination
              document.getElementById('destinationAirport').textContent=airports[airports.length-1];

              // Route summary
              document.getElementById('routeSummary').textContent=summary;

              // Route info
              document.getElementById('routeData').innerText=info;
            }
              
            fr.readAsText(this.files[0]);
        })
    </script>
</body>
</html>